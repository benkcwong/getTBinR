<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Exploring Estimates of the Tuberculosis Case Fatality Ratio • Get WHO Tuberculosis Data in R</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="Exploring Estimates of the Tuberculosis Case Fatality Ratio">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">getTBinR</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../articles/intro.html">Getting Started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Case Studies
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/case_study_global_trends.html">Exploring Global Trends in Tuberculosis Incidence Rates</a>
    </li>
    <li>
      <a href="../articles/case_fatality_rate.html">Exploring Estimates of the Tuberculosis Case Fatality Ratio</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Dashboards
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="http://www.seabbs.co.uk/shiny/ExploreGlobalTB/">Explore Global Tuberculosis</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../reference/index.html">
    <span class="fa fa-file-code-o"></span>
     
    Functions
  </a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="https://github.com/seabbs/getTBinR">
    <span class="fa fa-github fa-lg"></span>
     
    Github
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Exploring Estimates of the Tuberculosis Case Fatality Ratio</h1>
                        <h4 class="author">Sam Abbott</h4>
            
            <h4 class="date">2018-03-14</h4>
          </div>

    
    
<div class="contents">
<p>This case study investigates World Health Organisation (WHO) estimates of the case fatality ratio for Tuberculosis (TB) in 2016. It then estimates case fatality rates using a simple approximation and compares the results to the WHO estimates. It was adapted from <a href="https://www.samabbott.co.uk/post/est-cfr-gettbinr/">this</a> blog post.</p>
<p>It is estimated that in 2016 there was more than 10 million cases of active TB, with 1.3 million deaths (<a href="https://en.wikipedia.org/wiki/Tuberculosis">source</a>). This makes TB the leading cause of death from an infectious disease. Despite the high numbers of cases globally, and high levels of mortality, TB is often considered a historic disease in developed countries. However, in recent years previously declining trends have flattened out and there is increasing concern surrounding multi-drug resistant TB, which has a greatly reduced the rate of successful treatment (<a href="http://www.who.int/mediacentre/factsheets/fs104/en/">source</a>).</p>
<p>A key component of TB control is reducing the case fatality rate from active TB, this post explores WHO estimates for the TB case fatality rate in 2016 and then estimates the case fatality rates in previous years. The first step is to download and install the required packages.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># install.packages("getTBinR")</span>
<span class="kw">library</span>(getTBinR)
<span class="co">#  install.packages("tidyverse")</span>
<span class="kw">library</span>(tidyverse)
<span class="co"># install.packages("viridis")</span>
<span class="kw">library</span>(viridis)
<span class="co"># install.packages("scales")</span>
<span class="kw">library</span>(scales)</code></pre></div>
<p>Now we use <code>getTBinR</code> to download the TB burden data and its accompanying data dictionary.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tb_burden &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_tb_burden.html">get_tb_burden</a></span>(<span class="dt">verbose =</span> <span class="ot">FALSE</span>)
dict &lt;-<span class="st"> </span><span class="kw"><a href="../reference/get_data_dict.html">get_data_dict</a></span>(<span class="dt">verbose =</span> <span class="ot">FALSE</span>)

tb_burden
<span class="co">#&gt; # A tibble: 3,651 x 91</span>
<span class="co">#&gt;    country  iso2  iso3  iso_numeric g_whoregion  year e_pop_num e_inc_100k</span>
<span class="co">#&gt;    &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;       &lt;int&gt; &lt;chr&gt;       &lt;int&gt;     &lt;int&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt;  1 Afghani… AF    AFG             4 Eastern Me…  2000  20093756       190.</span>
<span class="co">#&gt;  2 Afghani… AF    AFG             4 Eastern Me…  2001  20966463       189.</span>
<span class="co">#&gt;  3 Afghani… AF    AFG             4 Eastern Me…  2002  21979923       189.</span>
<span class="co">#&gt;  4 Afghani… AF    AFG             4 Eastern Me…  2003  23064851       189.</span>
<span class="co">#&gt;  5 Afghani… AF    AFG             4 Eastern Me…  2004  24118979       189.</span>
<span class="co">#&gt;  6 Afghani… AF    AFG             4 Eastern Me…  2005  25070798       189.</span>
<span class="co">#&gt;  7 Afghani… AF    AFG             4 Eastern Me…  2006  25893450       189.</span>
<span class="co">#&gt;  8 Afghani… AF    AFG             4 Eastern Me…  2007  26616792       189.</span>
<span class="co">#&gt;  9 Afghani… AF    AFG             4 Eastern Me…  2008  27294031       189.</span>
<span class="co">#&gt; 10 Afghani… AF    AFG             4 Eastern Me…  2009  28004331       189.</span>
<span class="co">#&gt; # ... with 3,641 more rows, and 83 more variables: e_inc_100k_lo &lt;dbl&gt;,</span>
<span class="co">#&gt; #   e_inc_100k_hi &lt;dbl&gt;, e_inc_num &lt;int&gt;, e_inc_num_lo &lt;int&gt;,</span>
<span class="co">#&gt; #   e_inc_num_hi &lt;int&gt;, e_inc_num_f014 &lt;int&gt;, e_inc_num_f014_lo &lt;int&gt;,</span>
<span class="co">#&gt; #   e_inc_num_f014_hi &lt;int&gt;, e_inc_num_f15plus &lt;int&gt;,</span>
<span class="co">#&gt; #   e_inc_num_f15plus_lo &lt;int&gt;, e_inc_num_f15plus_hi &lt;int&gt;,</span>
<span class="co">#&gt; #   e_inc_num_f &lt;int&gt;, e_inc_num_f_lo &lt;int&gt;, e_inc_num_f_hi &lt;int&gt;,</span>
<span class="co">#&gt; #   e_inc_num_m014 &lt;int&gt;, e_inc_num_m014_lo &lt;int&gt;,</span>
<span class="co">#&gt; #   e_inc_num_m014_hi &lt;int&gt;, e_inc_num_m15plus &lt;int&gt;,</span>
<span class="co">#&gt; #   e_inc_num_m15plus_lo &lt;int&gt;, e_inc_num_m15plus_hi &lt;int&gt;,</span>
<span class="co">#&gt; #   e_inc_num_m &lt;int&gt;, e_inc_num_m_lo &lt;int&gt;, e_inc_num_m_hi &lt;int&gt;,</span>
<span class="co">#&gt; #   e_inc_num_014 &lt;int&gt;, e_inc_num_014_lo &lt;int&gt;, e_inc_num_014_hi &lt;int&gt;,</span>
<span class="co">#&gt; #   e_inc_num_15plus &lt;int&gt;, e_inc_num_15plus_lo &lt;int&gt;,</span>
<span class="co">#&gt; #   e_inc_num_15plus_hi &lt;int&gt;, e_tbhiv_prct &lt;dbl&gt;, e_tbhiv_prct_lo &lt;dbl&gt;,</span>
<span class="co">#&gt; #   e_tbhiv_prct_hi &lt;dbl&gt;, e_inc_tbhiv_100k &lt;dbl&gt;,</span>
<span class="co">#&gt; #   e_inc_tbhiv_100k_lo &lt;dbl&gt;, e_inc_tbhiv_100k_hi &lt;dbl&gt;,</span>
<span class="co">#&gt; #   e_inc_tbhiv_num &lt;int&gt;, e_inc_tbhiv_num_lo &lt;int&gt;,</span>
<span class="co">#&gt; #   e_inc_tbhiv_num_hi &lt;int&gt;, e_mort_exc_tbhiv_100k &lt;dbl&gt;,</span>
<span class="co">#&gt; #   e_mort_exc_tbhiv_100k_lo &lt;dbl&gt;, e_mort_exc_tbhiv_100k_hi &lt;dbl&gt;,</span>
<span class="co">#&gt; #   e_mort_exc_tbhiv_num &lt;int&gt;, e_mort_exc_tbhiv_num_lo &lt;int&gt;,</span>
<span class="co">#&gt; #   e_mort_exc_tbhiv_num_hi &lt;int&gt;, e_mort_tbhiv_100k &lt;dbl&gt;,</span>
<span class="co">#&gt; #   e_mort_tbhiv_100k_lo &lt;dbl&gt;, e_mort_tbhiv_100k_hi &lt;dbl&gt;,</span>
<span class="co">#&gt; #   e_mort_tbhiv_num &lt;int&gt;, e_mort_tbhiv_num_lo &lt;int&gt;,</span>
<span class="co">#&gt; #   e_mort_tbhiv_num_hi &lt;int&gt;, e_mort_100k &lt;dbl&gt;, e_mort_100k_lo &lt;dbl&gt;,</span>
<span class="co">#&gt; #   e_mort_100k_hi &lt;dbl&gt;, e_mort_num &lt;int&gt;, e_mort_num_lo &lt;int&gt;,</span>
<span class="co">#&gt; #   e_mort_num_hi &lt;int&gt;, cfr &lt;dbl&gt;, cfr_lo &lt;dbl&gt;, cfr_hi &lt;dbl&gt;,</span>
<span class="co">#&gt; #   c_newinc_100k &lt;dbl&gt;, c_cdr &lt;dbl&gt;, c_cdr_lo &lt;dbl&gt;, c_cdr_hi &lt;dbl&gt;,</span>
<span class="co">#&gt; #   source_rr_new &lt;chr&gt;, source_drs_coverage_new &lt;chr&gt;,</span>
<span class="co">#&gt; #   source_drs_year_new &lt;chr&gt;, e_rr_pct_new &lt;dbl&gt;, e_rr_pct_new_lo &lt;dbl&gt;,</span>
<span class="co">#&gt; #   e_rr_pct_new_hi &lt;dbl&gt;, e_mdr_pct_rr_new &lt;int&gt;, source_rr_ret &lt;chr&gt;,</span>
<span class="co">#&gt; #   source_drs_coverage_ret &lt;chr&gt;, source_drs_year_ret &lt;chr&gt;,</span>
<span class="co">#&gt; #   e_rr_pct_ret &lt;dbl&gt;, e_rr_pct_ret_lo &lt;dbl&gt;, e_rr_pct_ret_hi &lt;dbl&gt;,</span>
<span class="co">#&gt; #   e_mdr_pct_rr_ret &lt;int&gt;, e_inc_rr_num &lt;int&gt;, e_inc_rr_num_lo &lt;int&gt;,</span>
<span class="co">#&gt; #   e_inc_rr_num_hi &lt;int&gt;, e_rr_in_notified_pulm &lt;int&gt;,</span>
<span class="co">#&gt; #   e_rr_in_notified_pulm_lo &lt;int&gt;, e_rr_in_notified_pulm_hi &lt;int&gt;</span>

dict
<span class="co">#&gt; # A tibble: 402 x 4</span>
<span class="co">#&gt;    variable_name            dataset              code_list   definition   </span>
<span class="co">#&gt;    &lt;chr&gt;                    &lt;chr&gt;                &lt;chr&gt;       &lt;chr&gt;        </span>
<span class="co">#&gt;  1 bmu                      Community engagement ""          Number of TB…</span>
<span class="co">#&gt;  2 bmu_community_impl       Community engagement ""          Number of TB…</span>
<span class="co">#&gt;  3 bmu_ref_data             Community engagement ""          Number of Ba…</span>
<span class="co">#&gt;  4 bmu_rxsupport_data       Community engagement ""          Number of Ba…</span>
<span class="co">#&gt;  5 bmu_rxsupport_data_coh   Community engagement ""          Total number…</span>
<span class="co">#&gt;  6 community_data_available Community engagement 0=No; 1=Yes Are data ava…</span>
<span class="co">#&gt;  7 notified_ref             Community engagement ""          Total number…</span>
<span class="co">#&gt;  8 notified_ref_community   Community engagement ""          Total number…</span>
<span class="co">#&gt;  9 rxsupport_community_coh  Community engagement ""          Total number…</span>
<span class="co">#&gt; 10 rxsupport_community_succ Community engagement ""          Total number…</span>
<span class="co">#&gt; # ... with 392 more rows</span></code></pre></div>
<p>We want to explore the case fatality rate (<code>cfr</code>), lets first look at the WHO definition.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/search_data_dict.html">search_data_dict</a></span>(<span class="st">"cfr"</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>knitr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>()</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">variable_name</th>
<th align="left">dataset</th>
<th align="left">code_list</th>
<th align="left">definition</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">cfr</td>
<td align="left">Estimates</td>
<td align="left"></td>
<td align="left">Estimated TB case fatality ratio</td>
</tr></tbody>
</table>
<p>Maps can be a useful first visualisation for summarising spatial data, although they can also be misleading for more complex comparisons. Lets look at global TB incidence rates (per 100,000 population) in 2016, and the WHO estimate of the case fatality ratio in the same year.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Map TB incidence rates - 2016</span>
mp1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/map_tb_burden.html">map_tb_burden</a></span>(<span class="dt">year =</span> <span class="dv">2016</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>, 
                     <span class="dt">viridis_palette =</span> <span class="st">"cividis"</span>, 
                     <span class="dt">viridis_direction =</span> <span class="op">-</span><span class="dv">1</span>
                     ) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">"Map of Tuberculosis Incidence Rates - 2016"</span>,
       <span class="dt">subtitle =</span> <span class="st">"Incidence rates are per 100,000 population"</span>)

mp1 </code></pre></div>
<p><img src="case_fatality_rate_files/figure-html/make-inc-map-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Map TB case fatality ratio -2016</span>
mp2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/map_tb_burden.html">map_tb_burden</a></span>(<span class="dt">metric =</span> <span class="st">"cfr"</span>, <span class="dt">year =</span> <span class="dv">2016</span>, 
                     <span class="dt">viridis_palette =</span> <span class="st">"cividis"</span>, 
                     <span class="dt">viridis_direction =</span> <span class="op">-</span><span class="dv">1</span>,
                     <span class="dt">verbose=</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">"Map of Tuberculosis Case Fatality Ratio - 2016"</span>,
       <span class="dt">subtitle =</span> <span class="st">"Case fatality rate estimated by the WHO"</span>)

mp2</code></pre></div>
<p><img src="case_fatality_rate_files/figure-html/make-cfr-map-1.png" width="672" style="display: block; margin: auto;"></p>
<p>Whilst quantitative insights are hard to glean from the above maps we can see that incidence rates appear to be highest in Africa and Asia. It also looks like the case fatality ratios are highest in these regions as well.</p>
<p>The WHO have only provided estimates for the case fatality ratio for 2016, estimating the case fatality ratio for other years will allow trends over time to be explored. We do this by first summarising TB incidence rates, and mortality rates by region. This allows insights into the general global picture to be more easily extracted. The first step is to write a function to summarise rates on regional levels, we do this using <code><a href="http://dplyr.tidyverse.org/reference/summarise_all.html">dplyr::summarise_at</a></code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Make function to summarise rates in a given region
rate_region &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">df =</span> <span class="ot">NULL</span>, <span class="dt">metric =</span> <span class="ot">NULL</span>) {
  
  metric_vars &lt;-<span class="st"> </span><span class="kw">c</span>(metric, <span class="kw">paste0</span>(metric, <span class="st">"_lo"</span>), <span class="kw">paste0</span>(metric, <span class="st">"_hi"</span>))
  
  df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">group_by</span>(year, g_whoregion) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">summarise_at</span>(<span class="dt">.vars =</span> <span class="kw">c</span>(metric_vars, <span class="st">"e_pop_num"</span>),
                 <span class="dt">.funs =</span> <span class="kw">funs</span>(<span class="kw">sum</span>(<span class="kw">as.numeric</span>(.), <span class="dt">na.rm =</span> T))) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">mutate_at</span>(<span class="dt">.vars =</span> metric_vars,
              <span class="dt">.funs =</span> <span class="kw">funs</span>(. <span class="op">/</span><span class="st"> </span>e_pop_num <span class="op">*</span><span class="st"> </span><span class="fl">1e5</span>))
}</code></pre></div>
<p>We then write a reusable plotting function to visualise this data (making use of <code>aes_string</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Plotting function for rates
plot_rate_region &lt;-<span class="st"> </span><span class="cf">function</span>(<span class="dt">df =</span> <span class="ot">NULL</span>, <span class="dt">metric =</span> <span class="ot">NULL</span>, <span class="dt">title =</span> <span class="ot">NULL</span>, <span class="dt">subtitle =</span> <span class="ot">NULL</span>, 
                             <span class="dt">y_lab =</span> <span class="ot">NULL</span>, <span class="dt">scales =</span> <span class="ot">NULL</span>) {
  
  metric_vars &lt;-<span class="st"> </span><span class="kw">c</span>(metric, <span class="kw">paste0</span>(metric, <span class="st">"_lo"</span>), <span class="kw">paste0</span>(metric, <span class="st">"_hi"</span>))
  
  df <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes_string</span>(<span class="dt">x =</span> <span class="st">"year"</span>, <span class="dt">y =</span> metric, <span class="dt">col =</span> <span class="st">"g_whoregion"</span>, 
                      <span class="dt">fill =</span> <span class="st">"g_whoregion"</span>)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="fl">1.3</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_ribbon</span>(<span class="kw">aes_string</span>(<span class="dt">ymin =</span> metric_vars[<span class="dv">2</span>], <span class="dt">ymax =</span> metric_vars[<span class="dv">3</span>]), <span class="dt">alpha =</span> <span class="fl">0.3</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_line</span>(<span class="dt">size =</span> <span class="fl">1.1</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">scale_y_continuous</span>(<span class="dt">labels =</span> comma) <span class="op">+</span>
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/viridis/topics/scale_viridis">scale_colour_viridis</a></span>(<span class="dt">discrete =</span> <span class="ot">TRUE</span>, <span class="dt">option =</span> <span class="st">"E"</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/viridis/topics/scale_viridis">scale_fill_viridis</a></span>(<span class="dt">discrete =</span> <span class="ot">TRUE</span>, <span class="dt">option =</span> <span class="st">"E"</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> title, <span class="dt">subtitle =</span> subtitle, 
         <span class="dt">x =</span> <span class="st">"Year"</span>, <span class="dt">y =</span> y_lab) <span class="op">+</span>
<span class="st">    </span><span class="kw">theme_minimal</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">"none"</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">facet_wrap</span>(<span class="op">~</span>g_whoregion, <span class="dt">scales =</span> scales)
}</code></pre></div>
<p>We can now quickly plot TB incidence rates by region, as well as mortality rates by region.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plot_inc_region &lt;-<span class="st"> </span>tb_burden <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">rate_region</span>(<span class="dt">metric =</span> <span class="st">"e_inc_num"</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">plot_rate_region</span>(<span class="dt">metric =</span> <span class="st">"e_inc_num"</span>,
                   <span class="dt">title =</span> <span class="st">"Tuberculosis Incidence Rates"</span>,
                   <span class="dt">subtitle =</span> <span class="st">"By region: 2000 to 2016"</span>,
                   <span class="dt">scales =</span> <span class="st">"free_y"</span>,
                   <span class="dt">y_lab =</span> <span class="st">"Tuberculosis Incidence Rates (per 100,000 population)"</span>)

plot_inc_region <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">caption =</span> <span class="st">"Source: World Health Organisation"</span>)</code></pre></div>
<p><img src="case_fatality_rate_files/figure-html/plot-tb-inc-reg-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plot_mort_region &lt;-<span class="st"> </span>tb_burden <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">rate_region</span>(<span class="dt">metric =</span> <span class="st">"e_mort_num"</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">plot_rate_region</span>(<span class="dt">metric =</span> <span class="st">"e_mort_num"</span>,
                   <span class="dt">title =</span> <span class="st">"Tuberculosis Mortality Rates"</span>,
                   <span class="dt">subtitle =</span> <span class="st">"By region: 2000 to 2016"</span>,
                   <span class="dt">scales =</span> <span class="st">"free_y"</span>,
                   <span class="dt">y_lab =</span> <span class="st">"Tuberculosis Mortality Rates (per 100,000 population)"</span>)

plot_mort_region <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">caption =</span> <span class="st">"Source: World Health Organisation"</span>)</code></pre></div>
<p><img src="case_fatality_rate_files/figure-html/plot-tb-mort-reg-1.png" width="672" style="display: block; margin: auto;"></p>
<p>This gives an encouraging picture with both incidence rates and mortality rates declining in all regions. As we observed from the maps above incidence rates (and mortality rates) are highest in Africa, and South-East Asia. We also see that the rate of decline in incidence rates varies across regions, with South-East Asia and the Eastern Mediterranean experiencing the slowest decreases. Interestingly it also appears that mortality rates in some areas are decreasing more quickly than incidence rates, this is most notable for Europe. As mortality rates and incidence rates are highly correlated to explore in more depth we need to estimate the case fatality ratio for all years in the data.</p>
<p>To validate our estimates we first extract the regional estimates for the case fatality ratio based on the WHO estimates, by taking the mean (and standard deviation) of case fatality ratios by country in each region. This gives an estimate for case fatality rates at the regional level as well as the between country variation.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Summarise Case fatality rate by region - only availble for 2016
region_case_fat &lt;-<span class="st"> </span>tb_burden <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(year <span class="op">%in%</span><span class="st"> </span><span class="dv">2016</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(year, g_whoregion) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(cfr, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>),
            <span class="dt">sd =</span> <span class="kw">sd</span>(cfr, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ll =</span> mean <span class="op">-</span><span class="st"> </span>sd,
         <span class="dt">lll =</span> mean <span class="op">-</span><span class="st"> </span><span class="dv">2</span><span class="op">*</span>sd,
         <span class="dt">hh =</span> mean <span class="op">+</span><span class="st"> </span>sd,
         <span class="dt">hhh =</span> mean <span class="op">+</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>sd)

region_case_fat
<span class="co">#&gt; # A tibble: 6 x 8</span>
<span class="co">#&gt; # Groups:   year [1]</span>
<span class="co">#&gt;    year g_whoregion             mean     sd       ll      lll    hh   hhh</span>
<span class="co">#&gt;   &lt;int&gt; &lt;chr&gt;                  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1  2016 Africa                0.238  0.0899  0.148    0.0581  0.328 0.418</span>
<span class="co">#&gt; 2  2016 Americas              0.132  0.133  -0.00116 -0.134   0.265 0.397</span>
<span class="co">#&gt; 3  2016 Eastern Mediterranean 0.131  0.129   0.00173 -0.127   0.260 0.389</span>
<span class="co">#&gt; 4  2016 Europe                0.0837 0.0458  0.0379  -0.00792 0.130 0.175</span>
<span class="co">#&gt; 5  2016 South-East Asia       0.135  0.0439  0.0916   0.0477  0.179 0.223</span>
<span class="co">#&gt; 6  2016 Western Pacific       0.0885 0.0483  0.0402  -0.00810 0.137 0.185</span></code></pre></div>
<p>We then estimate the regional case fatality ratio by taking the regional mortality rate and dividing it by the regional incidence rate for each year. We also do this for the high and low mortality rate estimates (using the lowest estimate for TB mortality and the highest estimate for incidence rates to get the lower bound, and vice versa for the high bound). This gives,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">region_case_fatality &lt;-<span class="st"> </span>tb_burden <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">rate_region</span>(<span class="dt">metric =</span> <span class="st">"e_inc_num"</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">left_join</span>(tb_burden <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">              </span><span class="kw">rate_region</span>(<span class="dt">metric =</span> <span class="st">"e_mort_num"</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">case_fat_rate =</span> e_mort_num <span class="op">/</span><span class="st"> </span>e_inc_num,
         <span class="dt">case_fat_rate_lo =</span> e_mort_num_lo <span class="op">/</span><span class="st"> </span>e_inc_num_hi,
         <span class="dt">case_fat_rate_hi =</span> e_mort_num_hi <span class="op">/</span><span class="st"> </span>e_inc_num_lo)
<span class="co">#&gt; Joining, by = c("year", "g_whoregion", "e_pop_num")</span>

region_case_fatality
<span class="co">#&gt; # A tibble: 102 x 12</span>
<span class="co">#&gt;     year g_whoregion        e_inc_num e_inc_num_lo e_inc_num_hi  e_pop_num</span>
<span class="co">#&gt;    &lt;int&gt; &lt;chr&gt;                  &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt;  1  2000 Africa                 332.         210.         481.      6.59e8</span>
<span class="co">#&gt;  2  2000 Americas                36.5         28.6         45.6     8.38e8</span>
<span class="co">#&gt;  3  2000 Eastern Mediterra…     127.          87.0        175.      4.81e8</span>
<span class="co">#&gt;  4  2000 Europe                  52.3         38.1         68.8     8.69e8</span>
<span class="co">#&gt;  5  2000 South-East Asia        305.         175.         473.      1.57e9</span>
<span class="co">#&gt;  6  2000 Western Pacific        131.          91.9        178.      1.70e9</span>
<span class="co">#&gt;  7  2001 Africa                 337.         215.         487.      6.76e8</span>
<span class="co">#&gt;  8  2001 Americas                35.0         27.4         43.6     8.48e8</span>
<span class="co">#&gt;  9  2001 Eastern Mediterra…     126.          86.2        174.      4.92e8</span>
<span class="co">#&gt; 10  2001 Europe                  51.9         37.7         68.3     8.70e8</span>
<span class="co">#&gt; # ... with 92 more rows, and 6 more variables: e_mort_num &lt;dbl&gt;,</span>
<span class="co">#&gt; #   e_mort_num_lo &lt;dbl&gt;, e_mort_num_hi &lt;dbl&gt;, case_fat_rate &lt;dbl&gt;,</span>
<span class="co">#&gt; #   case_fat_rate_lo &lt;dbl&gt;, case_fat_rate_hi &lt;dbl&gt;</span></code></pre></div>
<p>We can then plot this using the <code>plot_rate_region</code> function outlined above, combined with addition layers to compare our estimate to that produced by the WHO.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plot_region_case_fatality &lt;-<span class="st"> </span>region_case_fatality <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">plot_rate_region</span>(<span class="dt">metric =</span> <span class="st">"case_fat_rate"</span>,
                   <span class="dt">title =</span> <span class="st">"Tuberculosis Case Fatality Rate"</span>,
                   <span class="dt">subtitle =</span> <span class="st">"By WHO region: 2000 to 2016"</span>,
                   <span class="dt">scales =</span> <span class="st">"free_y"</span>,
                   <span class="dt">y_lab =</span> <span class="st">"Estimated TB Case Fatality Ratio"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">caption =</span> <span class="st">"Case fatality ratio estimated by taking the ratio of TB mortality rates and TB incidence rates each year in all years. For 2016 </span>
<span class="st">       the mean regional case fatality ratio estimated by the WHO is also shown (along with one and two standard deviations)"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> region_case_fat, <span class="kw">aes</span>(<span class="dt">y =</span> mean, <span class="dt">x =</span> year, <span class="dt">fill =</span> g_whoregion), <span class="dt">shape =</span> <span class="dv">2</span>, <span class="dt">size =</span> <span class="fl">1.3</span>, <span class="dt">col =</span> <span class="st">"black"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_linerange</span>(<span class="dt">data =</span> region_case_fat, <span class="kw">aes</span>(<span class="dt">ymin =</span> ll, <span class="dt">ymax =</span> hh, <span class="dt">y =</span> <span class="ot">NULL</span>), <span class="dt">alpha =</span> <span class="fl">0.4</span>, <span class="dt">size =</span> <span class="fl">1.2</span>, <span class="dt">col =</span> <span class="st">"black"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_linerange</span>(<span class="dt">data =</span> region_case_fat, <span class="kw">aes</span>(<span class="dt">ymin =</span> lll, <span class="dt">ymax =</span> hhh, <span class="dt">y =</span> <span class="ot">NULL</span>), <span class="dt">alpha =</span> <span class="fl">0.2</span>, <span class="dt">size =</span> <span class="fl">1.2</span>, <span class="dt">col =</span> <span class="st">"black"</span>)
<span class="co">#&gt; Warning: Ignoring unknown aesthetics: y</span>

<span class="co">#&gt; Warning: Ignoring unknown aesthetics: y</span>
  
plot_region_case_fatality <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">caption =</span> <span class="st">"Source: World Health Organisation"</span>)</code></pre></div>
<p><img src="case_fatality_rate_files/figure-html/plot-regional-cfr-1.png" width="672" style="display: block; margin: auto;"></p>
<p>We see that the estimate using mortality rates / incidence rates compares well to the estimate published for 2016 by the WHO, although there is substantial within country variation. For all regions our estimate has substantial uncertainty. The plot suggests that the TB case fatality ratio is decreasing over time in all regions, although this reduction appears to be very minimal in some regions (such as the Americas, Africa, and the Eastern Mediterranean). It is likely that this trend does not hold across all countries, but this is beyond the scope of this post (watch this space).</p>
<p>As a first look at the case fatality ratios in individual countries we can quickly pull out the 10 countries with the highest case fatality ratio in 2016. These are,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">highest_case_fataltity_countries &lt;-<span class="st"> </span>tb_burden <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(year <span class="op">%in%</span><span class="st"> </span><span class="dv">2016</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(cfr)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">slice</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">pull</span>(country)

highest_case_fataltity_countries
<span class="co">#&gt;  [1] "Barbados"                    "United Arab Emirates"       </span>
<span class="co">#&gt;  [3] "Anguilla"                    "Lesotho"                    </span>
<span class="co">#&gt;  [5] "Ghana"                       "Guinea-Bissau"              </span>
<span class="co">#&gt;  [7] "Nigeria"                     "United Republic of Tanzania"</span>
<span class="co">#&gt;  [9] "Mozambique"                  "Kenya"</span></code></pre></div>
<p>We can then plot the TB case fatality ratio in these countries, as well as the TB incidence rates over time.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">## Plot overview of cases fatality ratios
plot_high_cfr &lt;-<span class="st"> </span><span class="kw"><a href="../reference/plot_tb_burden_overview.html">plot_tb_burden_overview</a></span>(<span class="dt">metric =</span> <span class="st">"cfr"</span>, 
                                         <span class="dt">countries =</span> highest_case_fataltity_countries,
                                         <span class="dt">verbose =</span> <span class="ot">FALSE</span>,
                                         <span class="dt">viridis_palette =</span> <span class="st">"cividis"</span>,
                                         <span class="dt">viridis_direction =</span> <span class="op">-</span><span class="dv">1</span>,
                                         <span class="dt">viridis_end =</span> <span class="fl">0.9</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">"none"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">"Tuberculosis Case Fatality Ratio - 2016"</span>,
       <span class="dt">subtitle =</span> <span class="st">"For the countries with the 10 highest ratios"</span>)

plot_high_cfr</code></pre></div>
<p><img src="case_fatality_rate_files/figure-html/plot-highest-cfr-countries-1.png" width="672" style="display: block; margin: auto;"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">plot_inc_high_cfr &lt;-<span class="st"> </span><span class="kw"><a href="../reference/plot_tb_burden_overview.html">plot_tb_burden_overview</a></span>(<span class="dt">countries =</span> highest_case_fataltity_countries,
                                             <span class="dt">verbose =</span> <span class="ot">FALSE</span>,
                                             <span class="dt">viridis_palette =</span> <span class="st">"cividis"</span>,
                                             <span class="dt">viridis_direction =</span> <span class="op">-</span><span class="dv">1</span>,
                                             <span class="dt">viridis_end =</span> <span class="fl">0.9</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">"none"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">"bottom"</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">"Tuberculosis Incidence Rates - 2000:2016"</span>,
       <span class="dt">subtitle =</span> <span class="st">"In the countries with the 10 highest TB case fatality ratios"</span>)

plot_inc_high_cfr </code></pre></div>
<p><img src="case_fatality_rate_files/figure-html/plot-inc-rates-high-cfr-1.png" width="672" style="display: block; margin: auto;"></p>
<p>We see that for some countries on this list (i.e Anguilla, the United Arab Emirates, and Barbados) the high case fatality ratio estimates are likely to be based on a very low sample size and therefore may not be trustworthy. Worryingly however for several countries (Lesotho, Tanzania, Kenya, Mozambique, Guinea-Bissau, and Ghana, and Nigeria) with extremely high case fatality ratios incidence rates are also very high, which will correspond to very high mortality rates. These countries are all in Africa, which as a region also had the highest incidence rates and the highest case fatality ratio. It is clear from these plots that Africa, and these countries in particular should be a particular focus of TB control efforts if TB mortality rates are to be reduced more quickly.</p>
<p>The WHO TB data contains many more variables not mentioned in this post and getTBinR contains additional features, see the <a href="https://www.samabbott.co.uk/getTBinR/">site for getTBinR</a> for details. See <a href="https://gist.github.com/seabbs">my gists</a> for code snippets to get you started in exploring the data further. Package feature requests are welcome, preferably by filing a <a href="https://github.com/seabbs/getTBinR/issues">GitHub issue</a>, as are suggestions for additional data sources to include.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Sam Abbott.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
